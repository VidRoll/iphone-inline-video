/*! npm.im/iphone-inline-video */
var makeVideoPlayableInline=function(){"use strict";function e(e){function n(t){r=requestAnimationFrame(n),e(t-(i||t)),i=t}var r,i;this.start=function(){r||n(0)},this.stop=function(){cancelAnimationFrame(r),r=null,i=0}}function n(e,n,r,i){function t(n){Boolean(e[r])===Boolean(i)&&n.stopImmediatePropagation(),delete e[r]}return e.addEventListener(n,t,!1),t}function r(e,n,r,i){function t(){return r[n]}function d(e){r[n]=e}i&&d(e[n]),Object.defineProperty(e,n,{get:t,set:d})}function i(e,n,r){r.addEventListener(n,function(){return e.dispatchEvent(new Event(n))})}function t(e,n){Promise.resolve().then(function(){e.dispatchEvent(new Event(n))})}function d(e){var n=new Audio;return i(e,"play",n),i(e,"playing",n),i(e,"pause",n),n.crossOrigin=e.crossOrigin,n.src=e.src||e.currentSrc||"data:",n}function a(e,n,r){(f||0)+200<Date.now()&&(e[h]=!0,f=Date.now()),r||(e.currentTime=n),T[++w%3]=100*n|0}function o(e){return e.driver.currentTime>=e.video.duration}function u(e){var n=this;n.video.readyState>=n.video.HAVE_FUTURE_DATA?(n.hasAudio||(n.driver.currentTime=n.video.currentTime+e*n.video.playbackRate/1e3,n.video.loop&&o(n)&&(n.driver.currentTime=0)),a(n.video,n.driver.currentTime)):n.video.networkState!==n.video.NETWORK_IDLE||n.video.buffered.length||n.video.load(),n.video.ended&&(delete n.video[h],n.video.pause(!0))}function s(){var e=this,n=e[g];return e.webkitDisplayingFullscreen?void e[b]():("data:"!==n.driver.src&&n.driver.src!==e.src&&(a(e,0,!0),n.driver.src=e.src),void(e.paused&&(n.paused=!1,e.buffered.length||e.load(),n.driver.play(),n.updater.start(),n.hasAudio||(t(e,"play"),n.video.readyState>=n.video.HAVE_ENOUGH_DATA&&t(e,"playing")))))}function c(e){var n=this,r=n[g];r.driver.pause(),r.updater.stop(),n.webkitDisplayingFullscreen&&n[E](),r.paused&&!e||(r.paused=!0,r.hasAudio||t(n,"pause"),n.ended&&(n[h]=!0,t(n,"ended")))}function v(n,r){var i=n[g]={};i.paused=!0,i.hasAudio=r,i.video=n,i.updater=new e(u.bind(i)),r?i.driver=d(n):(n.addEventListener("canplay",function(){n.paused||t(n,"playing")}),i.driver={src:n.src||n.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,o(i)&&(console.log("=================== setTime 0"),i.updater.stop())},get ended(){return o(i)}}),n.addEventListener("emptied",function(){var e=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==n.src&&(a(n,0,!0),i.driver.src=n.src,e?i.driver.play():i.updater.stop())},!1),n.addEventListener("webkitbeginfullscreen",function(){n.paused?r&&!i.driver.buffered.length&&i.driver.load():(n.pause(),n[b]())}),r&&(n.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=n.currentTime}),n.addEventListener("seeking",function(){T.indexOf(100*n.currentTime|0)<0&&(i.driver.currentTime=n.currentTime)}))}function p(e){var i=e[g];e.inLineVideo=!0,e[b]=e.play,e[E]=e.pause,e.play=s,e.pause=c,r(e,"paused",i.driver),r(e,"muted",i.driver,!0),r(e,"playbackRate",i.driver,!0),r(e,"ended",i.driver),r(e,"loop",i.driver,!0),n(e,"seeking"),n(e,"seeked"),n(e,"timeupdate",h,!1),n(e,"ended",h,!1)}function l(e,n,r){void 0===n&&(n=!0),void 0===r&&(r=!0),r&&!y||e[g]||(e.inLineVideo||(v(e,n),p(e),e.classList.add("IIV")),!n&&e.autoplay&&e.play(),"MacIntel"!==navigator.platform&&"Windows"!==navigator.platform||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}var f,m="undefined"==typeof Symbol?function(e){return"@"+(e||"@")+Math.random()}:Symbol,y=/iPhone|iPod/i.test(navigator.userAgent)&&void 0===document.head.style.grid,g=m(),h=m(),b=m("nativeplay"),E=m("nativepause"),T=[],w=0;return l.isWhitelisted=y,l}();